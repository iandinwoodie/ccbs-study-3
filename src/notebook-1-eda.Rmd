---
title: "Exploratory Data Analysis"
date: "`r Sys.Date()`"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
library(tidyverse)
library(ggpubr)
library(GGally)
knitr::opts_chunk$set(echo=TRUE)
```

# Overview

This notebook documents the exploratory data analysis undertaken for this
project.

# Loading the Data

Load the tidy data set into memory. If it does not exist, then run the notebook
that builds it.

```{r}
tidy_data_filepath <- '../data/tidy.Rds'
if (!file.exists(tidy_data_filepath)) {
  rmarkdown::render('./notebook-0-tidy.Rmd')
}
df <- readRDS(tidy_data_filepath)
stopifnot(identical(dim(df)+0, c(1011, 107)))
str(df)
```
## Overview of Data Set

# summarize data

```{r}
summary(df)

```

```{r}
# Number of unique owners after inclusion criteria.
length(unique(df$owner_id))

```

```{r}
#number of dogs per household.
summary(plyr::count(df, 'owner_id'))
```
Median number of dogs per household = 1 (range: 1 to 21), mean 1.9. Now we can
drop the column to simply the data set.

```{r}
df <- subset(df, select=-c(owner_id))
```

Before we look at the data, let's add a basic behavior problem indicator column.

#how may dogs have any behavior issue? 

```{r}

df <- df %>%
  mutate(behav_problem = ifelse(
    dog_was_aggressive | dog_has_fear_or_anxiety | dog_has_jumped_problematically | 
      dog_has_barked_excessively | dog_has_coprophagia | dog_has_repetitive_behavior |
      dog_has_house_soiled | dog_has_rolled_in_repulsive_material | dog_was_hyperactive | 
      dog_was_destructive | dog_has_escaped | dog_has_mounted, TRUE, FALSE))
summary(df$behav_problem)

#create variable with number of behavior problems
df_temp <- df[,c('dog_was_aggressive', 'dog_has_fear_or_anxiety', 'dog_has_jumped_problematically', 
      'dog_has_barked_excessively', 'dog_has_coprophagia', 'dog_has_repetitive_behavior',
      'dog_has_house_soiled', 'dog_has_rolled_in_repulsive_material', 'dog_was_hyperactive', 
      'dog_was_destructive', 'dog_has_escaped', 'dog_has_mounted')]

#count number of 'True' responses per row
df$num_behv_problems <- rowSums(df_temp,na.rm=TRUE)
summary(df$num_behv_problems)
  
```

#summary stats specific to included responses

```{r}

summary(df[df$dog_adolescent_or_adult_training==TRUE | df$dog_adolescent_or_adult_training==FALSE,])

length(which(df$training_complete_age_continue_in_home==TRUE | df$training_complete_age_continue_classes==TRUE))

```

# general notes on dataset: (all stats exclude no answer or NA's unless otherwise stated)
-- 322 (out of 1011 total obs) responses are excluded due to no response (NA's) in either training or behavior questions; many of these dogs were too young to take part in the survey (<12 mo)
-- 671 out of 689 or 97.4% reported at least one behavior problem
-- median number of behavior problems is 4, and mean is 3.7
-- Dog gender spilt almost even, slight bias towards male (478 F / 507 M total, 325 F / 364 M with valid responses)
-- 634 unique dog owners, median 1 dog owned, mean 1.6 (all respondents)
-- Mean age (in months) is 80.9 (6.7 years) and median age is 75 (6.25 years) [Note all dogs less than 12 months excluded from analysis]
-- a majority of respondents (389/689 = 56%) acquired their dog in the pre-adolescent stage
-- of the respondents who provided an answer (559), just under half of dogs had attended pre-adolescent training (260/559 = 46.5%). The majority of these dogs (209/260 = 80.4%) had received reward-based training only. A further 15% (39/260) received a mix of reward and discipline-based training. The vast majority (229/260 = 88%) attended group classes (as opposed to private training or boot camp).
-- More than half of dogs had attended adolescent or adult training (442/689 = 64.2%). The vast majority (358/442 = 81.0%) reported receiving reward-based training only and attended group classes (387/442 = 87.6%)

-- the majority continued some form of training post-puppyhood: 11% (77/689) completed in adolescence (defined as 6 to 18 months), 10.6% (73/689) completed between ages 18-36 months (social maturity), 39.6% (273/689) continue to train in-home, and 32.8% (226/689) continue to attend classes, with 53% (365/689) reporting some kind of continued training 


#specific behavior problems:
-- 56.2% reported aggression (387/689)
-- 73.9% reported fear or anxiety (509/689)
-- 19.4% reported problematic jumping (134/689)
-- 19.0% reported excessive barking (131/689)
-- 41.7% reported coprophagia (287/689)
-- 26.9% reported repetitive behavior (185/689)
-- 23.1% reported house soiling (159/689)
-- 41.1% reported rolling in repulsive material (283/689)
-- 12.5% reported hyperactivity (86/689)
-- 15.4% reported destructive behavior (106/689)
-- 26.3% reported escaping (181/689)
-- 18.4% reported mounting (127/689)




# make some plots to visualise data

```{r}

# how many of dogs with behavior problems have had pre-adolescent training?

ggplot(df, aes(x = dog_attended_pre_adolescent_training)) +
  geom_bar() + geom_text(aes(label=..count..),stat='count',vjust=-0.2)

ggplot(data = df) +  
       geom_count(mapping = aes(x = dog_attended_pre_adolescent_training, y = behav_problem)) 

df %>% 
  # create a column called n for number of times x & y occur together
  count(dog_attended_pre_adolescent_training, behav_problem) %>% 
  # create columns for each unique value of y and 
  # put the values of column n below
  spread(key = behav_problem, value = n, fill = 0) 

df %>% 
  count(dog_attended_pre_adolescent_training, behav_problem) %>%  
  ggplot(mapping = aes(x = dog_attended_pre_adolescent_training, y = behav_problem)) +
    geom_tile(mapping = aes(fill = n))

```


```{r}

# how many of dogs with behavior problems have had adolescent/adult training?

ggplot(df, aes(x = dog_adolescent_or_adult_training)) +
  geom_bar() + geom_text(aes(label=..count..),stat='count',vjust=-0.2)

ggplot(data = df) +  
       geom_count(mapping = aes(x = dog_adolescent_or_adult_training, y = behav_problem)) 

df %>% 
  # create a column called n for number of times x & y occur together
  count(dog_adolescent_or_adult_training, behav_problem) %>% 
  # create columns for each unique value of y and 
  # put the values of column n below
  spread(key = behav_problem, value = n, fill = 0) 

df %>% 
  count(dog_adolescent_or_adult_training, behav_problem) %>%  
  ggplot(mapping = aes(x = dog_adolescent_or_adult_training, y = behav_problem)) +
    geom_tile(mapping = aes(fill = n))

```
Of the owners/dogs that reported any behavioral problems,

less than half (46.1% or 250 out of 542 responses) had attended pre-adolescent training
more than half (62.6% or 431 out of 689) had attended adolescent or adult training

there is likely an association between dogs with behavior issues and attending adolescent / adult training i.e. owners with dogs that have issues are more likely to sign up for additional training

However almost all dogs had some kind of behavior problem, so this is not likely to be significant


# examine variable distribution for all variables

```{r}
library(moments)

ggplot(df, aes(dog_age_in_months)) + geom_bar(fill='steelblue')
skewness(df$dog_age_in_months,na.rm=TRUE)

ggplot(df, aes(owner_age)) + geom_bar(fill='steelblue')
skewness(df$owner_age,na.rm=TRUE)

```

We see a right skew in the dog age plot, and a left skew in the owner age plot. Let's try to center it by applying a log transform.

```{r}
df <- df %>%
  mutate(log_dog_age = log(dog_age_in_months))
ggplot(df, aes(log_dog_age)) + geom_bar(fill='steelblue')
skewness(df$log_dog_age,na.rm=TRUE)


df <- df %>%
  mutate(log_owner_age = log(owner_age))
ggplot(df, aes(log_owner_age)) + geom_bar(fill='steelblue')
skewness(df$log_owner_age,na.rm=TRUE)

df <- subset(df, select=-c(log_dog_age))
df <- subset(df, select=-c(log_owner_age))


```
not helpful-- still skews with log transform



pairwise scatter plots for columns that all participants responded
(i.e., no NA responses), excluding the individual behavior problem
columns for brevity.

```{r, fig.height=5, fig.width=5}
df %>%
  ggpairs(columns=c('dog_attended_pre_adolescent_training', 'dog_adolescent_or_adult_training', 
                    'dog_gender'),
          mapping=ggplot2::aes(color=behav_problem),
          diag=list(discrete='barDiag',
                    continuous=wrap('densityDiag', alpha=0.5)),
          legend=1,
          progress=FALSE) +
  theme(legend.position='bottom')
```

We want to isolate the effect of adolescent / adult training, controlling for the fact that some dogs have also received pre-adolescent training
control group: those who had pre-adolescent training but no further training
exp group: those with pre-adolescent training and adolescent and/or adult training

```{r}
df_control <- subset(df, dog_attended_pre_adolescent_training==TRUE & dog_adolescent_or_adult_training==FALSE)
df_exp <- subset(df, dog_attended_pre_adolescent_training==TRUE & dog_adolescent_or_adult_training==TRUE)
df_adult_only <- subset(df, dog_attended_pre_adolescent_training==FALSE & dog_adolescent_or_adult_training==TRUE)
df_no_training <- subset(df, dog_attended_pre_adolescent_training==FALSE & dog_adolescent_or_adult_training==FALSE)

nrow(df_control) + nrow(df_exp) + nrow(df_adult_only) + nrow(df_no_training)

df_continue_training <- subset(df, training_complete_age_continue_in_home==TRUE | training_complete_age_continue_classes==TRUE)


```

Of the 1011 total survey responses, 452 need to be excluded because they did not answer whether the dog had received pre-adolescent training and/or adult training. This leaves 559 responses. The breakdown of the group:

177 had no training (neither pre-adolescent or adult)
37 had pre-adolescent but no further training
223 had pre-adolescent and adult training
122 had no pre-adolescent training but did have adult training

```{r}
# how many of dogs with behavior problems have had pre-adolescent training but no further training?
ggplot(df_control, aes(x = behav_problem)) +
  geom_bar() + geom_text(aes(label=..count..),stat='count',vjust=-0.2)

# how many of dogs with behavior problems have had pre-adolescent training and adult training?
ggplot(df_exp, aes(x = behav_problem)) +
  geom_bar() + geom_text(aes(label=..count..),stat='count',vjust=-0.2)

# how many of dogs with behavior problems have had no training?
ggplot(df_no_training, aes(x = behav_problem)) +
  geom_bar() + geom_text(aes(label=..count..),stat='count',vjust=-0.2)

# how many of dogs with behavior problems have had adult training only?
ggplot(df_adult_only, aes(x = behav_problem)) +
  geom_bar() + geom_text(aes(label=..count..),stat='count',vjust=-0.2)

```
# small sample problem? too many dogs have at least one behavior problem

control group: 1 no behavior problem, 36 yes 
exp group: 9 no, 214 yes 
no training: 6 no, 171 yes 
only adult training: 1 no, 121 yes 

```{r, fig.height=5, fig.width=5}
df %>%
  ggpairs(columns=c('dog_attended_pre_adolescent_training', 'dog_adolescent_or_adult_training', 
                    'dog_gender','dog_was_acquired_pre_adolescent', 'dog_age_in_months', 
                    'owner_gender'),
          mapping=ggplot2::aes(color=behav_problem),
          diag=list(discrete='barDiag',
                    continuous=wrap('densityDiag', alpha=0.5)),
          legend=1,
          progress=FALSE) +
  theme(legend.position='bottom')
```
There are too few dogs without behavior issues to draw any conclusions from this figure

Create column indicating whether the dog had any type of training (preadolescent or adult)

```{r}

df <- df %>%
  mutate(any_training = ifelse(
    dog_attended_pre_adolescent_training | dog_adolescent_or_adult_training & !is.na(dog_attended_pre_adolescent_training), 
    TRUE, FALSE))
summary(df$any_training)
```

How many dogs have behaviour problems with no vs. some training?

```{r}

ggplot(data = df) +  
       geom_count(mapping = aes(x = any_training, y = behav_problem))

df %>% 
  count(any_training, behav_problem) %>%  
  ggplot(mapping = aes(x = any_training, y = behav_problem)) +
    geom_tile(mapping = aes(fill = n))


```

```{r}
#nrow(df[df$any_training == FALSE & df$behav_problem == FALSE, ])
#nrow(df[df$any_training == FALSE & df$behav_problem == TRUE, ])

df1 = subset(df, any_training == FALSE & behav_problem == FALSE)
df2 = subset(df, any_training == FALSE & behav_problem == TRUE)

df3 = subset(df, any_training == TRUE & behav_problem == FALSE)
df4 = subset(df, any_training == TRUE & behav_problem == TRUE)

```

6 dogs with no training have no behavior problems
171 dogs with no training do have behavior problems
11 dogs with some training have no behavior problems
371 dogs with some training do have behavior problems

(Most dogs in the study have at least one behavior problem)

```{r, fig.height=5, fig.width=5}
df %>%
  ggpairs(columns=c('any_training', 'dog_adolescent_or_adult_training', 
                    'dog_attended_pre_adolescent_training'),
          mapping=ggplot2::aes(color=behav_problem),
          diag=list(discrete='barDiag',
                    continuous=wrap('densityDiag', alpha=0.5)),
          legend=1,
          progress=FALSE) +
  theme(legend.position='bottom')

```
#look at number of behavior problems

```{r}

ggplot(df, aes(num_behv_problems)) + geom_bar(fill='steelblue')

```
the majority of dogs with behavior problems have more than one (2-4)

#visualise continuous variables (dog age and num of behavior problems)

```{r}
df %>%
  ggpairs(columns=c('dog_age_in_months', 
                    'num_behv_problems'),
          mapping=ggplot2::aes(color=dog_attended_pre_adolescent_training),
          diag=list(discrete='barDiag',
                    continuous=wrap('densityDiag', alpha=0.5)),
          legend=1,
          progress=FALSE) +
  theme(legend.position='bottom')


df %>%
  ggpairs(columns=c('dog_age_in_months', 
                    'num_behv_problems'),
          mapping=ggplot2::aes(color=dog_adolescent_or_adult_training),
          diag=list(discrete='barDiag',
                    continuous=wrap('densityDiag', alpha=0.5)),
          legend=1,
          progress=FALSE) +
  theme(legend.position='bottom')
```
It appears that dogs who received either pre-adolescent or adult training have fewer behavior problems on average

## Discrete Variables

### Independent Variables

```{r, fig.height=5, fig.width=5}
vars <- c(
  'any_training',
  'dog_was_acquired_pre_adolescent',
  'dog_attended_pre_adolescent_training',
  'dog_adolescent_or_adult_training',
  'dog_gender',
  'trainer_group_classes',
  'trainer_boot_camp',
  'trainer_home_private',
  'training_complete_age_6_to_18mo',
  'training_complete_age_18_to_36mo',
  'training_complete_age_continue_in_home',
  'training_complete_age_continue_classes'
)

plot_list <- list()
for (i in 1:length(vars)) {
  col <- vars[i]
  p <- df %>%
    select(col) %>%
    drop_na(col) %>%
    ggplot(aes_string(x = col)) +
    geom_bar(fill='steelblue')
  plot_list[[i]] <- p
}
ggarrange(plotlist=plot_list, ncol=3, nrow=4)
```
```{r} 
#save figure
png(file="/Users/ekeller/ccbs/ccbs-study-3/figures/training_variables_barplot.png",
width=12, height=8, units="in", res=300)
ggarrange(plotlist=plot_list, ncol=3, nrow=4)
dev.off()
```

### Dependent Variables

```{r, fig.height=4, fig.width=5}
outcomes <- c(
  'dog_was_aggressive',
  'dog_has_fear_or_anxiety',
  'dog_has_jumped_problematically',
  'dog_has_barked_excessively',
  'dog_has_coprophagia',
  'dog_has_repetitive_behavior',
  'dog_has_house_soiled',
  'dog_has_rolled_in_repulsive_material',
  'dog_was_hyperactive',
  'dog_was_destructive',
  'dog_has_escaped',
  'dog_has_mounted'
)

plot_list <- list()
for (i in 1:length(outcomes)) {
  col <- outcomes[i]
  p <- df %>%
    select(col) %>%
    drop_na(col) %>%
    ggplot(aes_string(x = col)) +
    geom_bar(fill='steelblue')
  plot_list[[i]] <- p
}
ggarrange(plotlist=plot_list, ncol=4, nrow=3)
```
```{r} 
#save figure
png(file="/Users/ekeller/ccbs/ccbs-study-3/figures/behavior_problems_barplot.png",
width=12, height=8, units="in", res=300)
ggarrange(plotlist=plot_list, ncol=3, nrow=4)
dev.off()
```

## Control vs Experimental Group

Our control group consists of the dogs who attended puppy training but no further training and our
experimental group consists of those who attended both puppy and adolescent/adult training.
Let's look at the variables common to both groups with the plot color indicating the presence of a behavior
problem. Since we know a vast majority of dogs have at least one behavior
problem, we need to look for trends in individual behavior problems for the
plots to be useful. 

## Within the Experimental Group

Within the experimental group we want to know the impact of various
training techniques on behavior problem occurrence. We
start by isolating the experimental group.

```{r}
summary(df_control)
```

```{r}
summary(df_exp)
```
Now we look at the impact of training age.

### Independent Variables

```{r, fig.height=5, fig.width=5}
vars_control <- c(
  'dog_was_acquired_pre_adolescent',
  'dog_gender',
  'dog_pre_adolescent_training_type',
  'dog_pre_adolescent_training_location'
  #'trainer_group_classes',
  #'trainer_boot_camp',
  #'trainer_home_private',
  #'training_complete_age_6_to_18mo',
  #'training_complete_age_18_to_36mo',
  #'training_complete_age_continue_in_home',
  #'training_complete_age_continue_classes'
)

plot_list <- list()
for (i in 1:length(vars_control)) {
  col <- vars_control[i]
  p <- df_control %>%
    select(col) %>%
    drop_na(col) %>%
    ggplot(aes_string(x = col)) +
    geom_bar(fill='steelblue')
  plot_list[[i]] <- p
}
ggarrange(plotlist=plot_list, ncol=2, nrow=2)
```

```{r} 
#save figure
png(file="/Users/ekeller/ccbs/ccbs-study-3/figures/independent_var_control.png",
width=12, height=8, units="in", res=300)
ggarrange(plotlist=plot_list, ncol=2, nrow=2)
dev.off()
```


```{r, fig.height=5, fig.width=5}
vars_exp <- c(
  'dog_was_acquired_pre_adolescent',
  'dog_gender',
  'dog_pre_adolescent_training_type',
  'dog_pre_adolescent_training_location',
  'trainer_group_classes',
  'trainer_boot_camp',
  'trainer_home_private',
  'training_complete_age_6_to_18mo',
  'training_complete_age_18_to_36mo',
  'training_complete_age_continue_in_home',
  'training_complete_age_continue_classes'
)

plot_list <- list()
for (i in 1:length(vars_exp)) {
  col <- vars_exp[i]
  p <- df_exp %>%
    select(col) %>%
    drop_na(col) %>%
    ggplot(aes_string(x = col)) +
    geom_bar(fill='steelblue')
  plot_list[[i]] <- p
}
ggarrange(plotlist=plot_list, ncol=3, nrow=4)
```

```{r} 
#save figure
png(file="/Users/ekeller/ccbs/ccbs-study-3/figures/independent_var_exp.png",
width=12, height=8, units="in", res=300)
ggarrange(plotlist=plot_list, ncol=3, nrow=4)
dev.off()
```

### Dependent Variables

```{r, fig.height=4, fig.width=5}
outcomes_control <- c(
  'dog_was_aggressive',
  'dog_has_fear_or_anxiety',
  'dog_has_jumped_problematically',
  'dog_has_barked_excessively',
  'dog_has_coprophagia',
  'dog_has_repetitive_behavior',
  'dog_has_house_soiled',
  'dog_has_rolled_in_repulsive_material',
  'dog_was_hyperactive',
  'dog_was_destructive',
  'dog_has_escaped',
  'dog_has_mounted'
)

plot_list_control <- list()
for (i in 1:length(outcomes_control)) {
  col <- outcomes_control[i]
  p <- df_control %>%
    select(col) %>%
    drop_na(col) %>%
    ggplot(aes_string(x = col)) +
    geom_bar(fill='steelblue')
  plot_list_control[[i]] <- p
}
ggarrange(plotlist=plot_list_control, ncol=4, nrow=3)
```

```{r} 
#save figure
png(file="/Users/ekeller/ccbs/ccbs-study-3/figures/behavior_problems_barplot_control.png",
width=12, height=8, units="in", res=300)
ggarrange(plotlist=plot_list_control, ncol=4, nrow=3)
dev.off()
```


```{r}

outcomes_exp = outcomes_control

plot_list_exp <- list()
for (i in 1:length(outcomes_exp)) {
  col <- outcomes_exp[i]
  p <- df_exp %>%
    select(col) %>%
    drop_na(col) %>%
    ggplot(aes_string(x = col)) +
    geom_bar(fill='steelblue')
  plot_list_exp[[i]] <- p
}
ggarrange(plotlist=plot_list_exp, ncol=4, nrow=3)

```
```{r} 
#save figure
png(file="/Users/ekeller/ccbs/ccbs-study-3/figures/behavior_problems_barplot_exp.png",
width=12, height=8, units="in", res=300)
ggarrange(plotlist=plot_list_exp, ncol=4, nrow=3)
dev.off()
```

# for the purposes of isolating the effect of adult training, 
# create df control + exp groups combined
# also check groups that did not receive pre-adolescence training

```{r}

df_combo_preK_training <- rbind(df_control,df_exp)
df_combo_no_preK_training <- rbind(df_adult_only,df_no_training)
df_combo_all <- rbind(df_control,df_exp,df_adult_only,df_no_training)

```

```{r, fig.height=10, fig.width=5}

#combined control and exp groups
#here we know that all dogs have received pre-adolescent training, so we don't need to check

attribs <- c(
  #'dog_attended_pre_adolescent_training',
  'dog_adolescent_or_adult_training'
)
attribs <- sort(attribs)

plot_list <- list()
cnt <- 1
labels <- NULL
for (i in 1:length(outcomes)) {
  outcome <- outcomes[i]
  for (j in 1:length(attribs)) {
    attrib <- attribs[j]
    p <- df_combo_preK_training %>%
      drop_na(attrib) %>%
      select(attrib, outcome) %>%
      ggplot(aes_string(x=attrib, fill=outcome)) +
      geom_bar(position = position_dodge(0.9)) +
      labs(fill='has this behavior problem') +
      theme(legend.position='none')
    plot_list[[cnt]] <- p
    cnt <- cnt + 1
    labels <- c(labels, outcome)
  }
}
ggarrange(plotlist=plot_list, ncol=3, nrow=4, common.legend=TRUE,
          font.label=list(size=10), vjust=0.75, legend='bottom', labels=labels)
```

```{r} 
#save figure
png(file="/Users/ekeller/ccbs/ccbs-study-3/figures/training_vs_behavior_combo.png",
width=12, height=8, units="in", res=300)
ggarrange(plotlist=plot_list, ncol=3, nrow=4,common.legend=TRUE,
          font.label=list(size=10), vjust=0.75, legend='bottom', labels=labels)
dev.off()
```

```{r, fig.height=10, fig.width=5}

#combined no pre-adolescent training groups
#here we know that all dogs have NOT received pre-adolescence training, so we don't need to check

attribs <- c(
  #'dog_attended_pre_adolescent_training',
  'dog_adolescent_or_adult_training'
)
attribs <- sort(attribs)

plot_list <- list()
cnt <- 1
labels <- NULL
for (i in 1:length(outcomes)) {
  outcome <- outcomes[i]
  for (j in 1:length(attribs)) {
    attrib <- attribs[j]
    p <- df_combo_no_preK_training %>%
      drop_na(attrib) %>%
      select(attrib, outcome) %>%
      ggplot(aes_string(x=attrib, fill=outcome)) +
      geom_bar(position = position_dodge(0.9)) +
      labs(fill='has this behavior problem') +
      theme(legend.position='none')
    plot_list[[cnt]] <- p
    cnt <- cnt + 1
    labels <- c(labels, outcome)
  }
}
ggarrange(plotlist=plot_list, ncol=3, nrow=4, common.legend=TRUE,
          font.label=list(size=10), vjust=0.75, legend='bottom', labels=labels)
```
```{r} 
#save figure
png(file="/Users/ekeller/ccbs/ccbs-study-3/figures/training_vs_behavior_combo_nopreK.png",
width=12, height=8, units="in", res=300)
ggarrange(plotlist=plot_list, ncol=3, nrow=4,common.legend=TRUE,
          font.label=list(size=10), vjust=0.75, legend='bottom', labels=labels)
dev.off()
```


```{r, fig.height=10, fig.width=5}

#all responses that answered the training question

attribs <- c(
  #'dog_attended_pre_adolescent_training',
  'dog_adolescent_or_adult_training'
)
attribs <- sort(attribs)

plot_list <- list()
cnt <- 1
labels <- NULL
for (i in 1:length(outcomes)) {
  outcome <- outcomes[i]
  for (j in 1:length(attribs)) {
    attrib <- attribs[j]
    p <- df_combo_all %>%
      drop_na(attrib) %>%
      select(attrib, outcome) %>%
      ggplot(aes_string(x=attrib, fill=outcome)) +
      geom_bar(position = position_dodge(0.9)) +
      labs(fill='has this behavior problem') +
      theme(legend.position='none')
    plot_list[[cnt]] <- p
    cnt <- cnt + 1
    labels <- c(labels, outcome)
  }
}
ggarrange(plotlist=plot_list, ncol=3, nrow=4, common.legend=TRUE,
          font.label=list(size=10), vjust=0.75, legend='bottom', labels=labels)
```


```{r} 
#save figure
png(file="/Users/ekeller/ccbs/ccbs-study-3/figures/adult_training_vs_behavior_barplot_main.png",
width=12, height=8, units="in", res=300)
ggarrange(plotlist=plot_list, ncol=3, nrow=4,common.legend=TRUE,
          font.label=list(size=10), vjust=0.75, legend='bottom', labels=labels)
dev.off()
```


```{r, fig.height=10, fig.width=5}

# Generate plots for each attribute split by a simple predictor.
pred <- 'dog_adolescent_or_adult_training'
attribs <- c(
  #'dog_was_acquired_pre_adolescent'
  #'dog_age_in_months'
  'dog_gender'
)
attribs <- sort(attribs)
outcomes <- sort(outcomes)

plot_list <- list()
cnt <- 1
labels <- NULL
for (i in 1:length(outcomes)) {
  outcome <- outcomes[i]
  for (j in 1:length(attribs)) {
    attrib <- attribs[j]
    p <- df_combo_all %>%
      drop_na(attrib) %>%
      select(attrib, outcome, pred) %>%
      ggplot(aes_string(x=attrib, fill=pred)) +
      geom_bar(position = position_dodge(0.9)) +
      labs(fill=pred) +
      theme(legend.position='none') +
      facet_grid(as.formula(paste0('.~', outcome)))
    plot_list[[cnt]] <- p
    cnt <- cnt + 1
    labels <- c(labels, outcome)
  }
}
ggarrange(plotlist=plot_list, ncol=3, nrow=4, common.legend=TRUE,
          font.label=list(size=10), vjust=0.75, legend='bottom', labels=labels)
```

```{r} 
#save figure
#filename = "/Users/ekeller/ccbs/ccbs-study-3/figures/adult_training_vs_behavior_acquired_preK.png"
#filename = "/Users/ekeller/ccbs/ccbs-study-3/figures/adult_training_vs_behavior_dog_age.png"
filename = "/Users/ekeller/ccbs/ccbs-study-3/figures/adult_training_vs_behavior_dog_gender.png"

png(file=filename,
width=12, height=8, units="in", res=300)
ggarrange(plotlist=plot_list, ncol=3, nrow=4,common.legend=TRUE,
          font.label=list(size=10), vjust=0.75, legend='bottom', labels=labels)
dev.off()
```


#if the dog was acquired pre-adolescent, there appears to be some postive impact of training on a few behaviors: excessive barking, coprophagia,  house soiling, repetitive behavior, and aggression

#gender and age do not seem to have much of an affect 

Next, we try to visual the impact (if any) of type of training

```{r, fig.height=10, fig.width=5}

df_exp_all <- df_combo_all %>%
  filter(dog_adolescent_or_adult_training == TRUE)

attribs <- c(
  'trainer_group_classes',
  'trainer_boot_camp',
  'trainer_home_private'
)

plot_list <- list()
cnt <- 1
labels <- NULL
for (i in 1:length(outcomes)) {
  outcome <- outcomes[i]
  for (j in 1:length(attribs)) {
    attrib <- attribs[j]
    p <- df_exp_all %>%
      drop_na(attrib) %>%
      select(attrib, outcome) %>%
      ggplot(aes_string(x=attrib, fill=outcome)) +
      geom_bar(position = position_dodge(0.9)) +
      labs(fill='has this behavior problem') +
      theme(legend.position='none')
    plot_list[[cnt]] <- p
    cnt <- cnt + 1
    labels <- c(labels, outcome)
  }
}
ggarrange(plotlist=plot_list, ncol=3, nrow=4, common.legend=TRUE,
          font.label=list(size=10), vjust=0.75, legend='bottom', labels=labels)
```
most dogs attended group classes, making the effect of location of training hard to discern

#does continuing training throughout adulthood have an impact on the outcome?

```{r, fig.height=10, fig.width=5}

attribs <- c(
  'training_complete_age_6_to_18mo',
  'training_complete_age_18_to_36mo',
  'training_complete_age_continue_in_home',
  'training_complete_age_continue_classes'
)

plot_list <- list()
cnt <- 1
labels <- NULL
for (i in 1:length(outcomes)) {
  outcome <- outcomes[i]
  for (j in 1:length(attribs)) {
    attrib <- attribs[j]
    p <- df_exp_all %>%
      drop_na(attrib) %>%
      select(attrib, outcome) %>%
      ggplot(aes_string(x=attrib, fill=outcome)) +
      geom_bar(position = position_dodge(0.9)) +
      labs(fill='has this behavior problem') +
      theme(legend.position='none')
    plot_list[[cnt]] <- p
    cnt <- cnt + 1
    labels <- c(labels, outcome)
  }
}
ggarrange(plotlist=plot_list, ncol=4, nrow=9, common.legend=TRUE,
          font.label=list(size=10), vjust=0.75, legend='bottom', labels=labels)
```


```{r}

#save datasets separated by pre-adolescent training status
saveRDS(df_control, '../data/df_control.Rds')
saveRDS(df_exp, '../data/df_exp.Rds')
saveRDS(df_no_training, '../data/df_no_training.Rds')
saveRDS(df_adult_only, '../data/df_adult_only.Rds')


```